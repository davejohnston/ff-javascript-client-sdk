var HarnessFFSDK=(()=>{var tt=Object.create,Re=Object.defineProperty,rt=Object.getPrototypeOf,nt=Object.prototype.hasOwnProperty,at=Object.getOwnPropertyNames,it=Object.getOwnPropertyDescriptor;var ie=Object.assign,ot=t=>Re(t,"__esModule",{value:!0});var st=(t,a)=>()=>(a||(a={exports:{}},t(a.exports,a)),a.exports),ft=(t,a)=>{for(var l in a)Re(t,l,{get:a[l],enumerable:!0})},dt=(t,a,l)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of at(a))!nt.call(t,s)&&s!=="default"&&Re(t,s,{get:()=>a[s],enumerable:!(l=it(a,s))||l.enumerable});return t},ct=t=>dt(ot(Re(t!=null?tt(rt(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Ie=(t,a,l)=>new Promise((s,x)=>{var A=O=>{try{N(l.next(O))}catch(K){x(K)}},V=O=>{try{N(l.throw(O))}catch(K){x(K)}},N=O=>O.done?s(O.value):Promise.resolve(O.value).then(A,V);N((l=l.apply(t,a)).next())});var Xe=st((ke,Oe)=>{(function(t){"use strict";var a=t.setTimeout,l=t.clearTimeout,s=t.XMLHttpRequest,x=t.XDomainRequest,A=t.ActiveXObject,V=t.EventSource,N=t.document,O=t.Promise,K=t.fetch,ue=t.Response,R=t.TextDecoder,_=t.TextEncoder,J=t.AbortController;if(typeof window!="undefined"&&typeof N!="undefined"&&!("readyState"in N)&&N.body==null&&(N.readyState="loading",window.addEventListener("load",function(e){N.readyState="complete"},!1)),s==null&&A!=null&&(s=function(){return new A("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function n(){}return n.prototype=e,new n}),Date.now||(Date.now=function(){return new Date().getTime()}),J==null){var M=K;K=function(e,n){var i=n.signal;return M(e,{headers:n.headers,credentials:n.credentials,cache:n.cache}).then(function(r){var c=r.body.getReader();return i._reader=c,i._aborted&&i._reader.cancel(),{status:r.status,statusText:r.statusText,headers:r.headers,body:{getReader:function(){return c}}}})},J=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function re(){this.bitsNeeded=0,this.codePoint=0}re.prototype.decode=function(e){function n(y,m,u){if(u===1)return y>=128>>m&&y<<m<=2047;if(u===2)return y>=2048>>m&&y<<m<=55295||y>=57344>>m&&y<<m<=65535;if(u===3)return y>=65536>>m&&y<<m<=1114111;throw new Error}function i(y,m){if(y===6*1)return m>>6>15?3:m>31?2:1;if(y===6*2)return m>15?3:2;if(y===6*3)return 3;throw new Error}for(var r=65533,c="",o=this.bitsNeeded,v=this.codePoint,E=0;E<e.length;E+=1){var p=e[E];o!==0&&(p<128||p>191||!n(v<<6|p&63,o-6,i(o,v)))&&(o=0,v=r,c+=String.fromCharCode(v)),o===0?(p>=0&&p<=127?(o=0,v=p):p>=192&&p<=223?(o=6*1,v=p&31):p>=224&&p<=239?(o=6*2,v=p&15):p>=240&&p<=247?(o=6*3,v=p&7):(o=0,v=r),o!==0&&!n(v,o,i(o,v))&&(o=0,v=r)):(o-=6,v=v<<6|p&63),o===0&&(v<=65535?c+=String.fromCharCode(v):(c+=String.fromCharCode(55296+(v-65535-1>>10)),c+=String.fromCharCode(56320+(v-65535-1&1023))))}return this.bitsNeeded=o,this.codePoint=v,c};var Fe=function(){try{return new R().decode(new _().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(R==null||_==null||!Fe())&&(R=re);var H=function(){};function b(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=H,this.onload=H,this.onerror=H,this.onreadystatechange=H,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=H}b.prototype.open=function(e,n){this._abort(!0);var i=this,r=this._xhr,c=1,o=0;this._abort=function(u){i._sendTimeout!==0&&(l(i._sendTimeout),i._sendTimeout=0),(c===1||c===2||c===3)&&(c=4,r.onload=H,r.onerror=H,r.onabort=H,r.onprogress=H,r.onreadystatechange=H,r.abort(),o!==0&&(l(o),o=0),u||(i.readyState=4,i.onabort(null),i.onreadystatechange())),c=0};var v=function(){if(c===1){var u=0,w="",Y=void 0;if("contentType"in r)u=200,w="OK",Y=r.contentType;else try{u=r.status,w=r.statusText,Y=r.getResponseHeader("Content-Type")}catch(ge){u=0,w="",Y=void 0}u!==0&&(c=2,i.readyState=2,i.status=u,i.statusText=w,i._contentType=Y,i.onreadystatechange())}},E=function(){if(v(),c===2||c===3){c=3;var u="";try{u=r.responseText}catch(w){}i.readyState=3,i.responseText=u,i.onprogress()}},p=function(u,w){if((w==null||w.preventDefault==null)&&(w={preventDefault:H}),E(),c===1||c===2||c===3){if(c=4,o!==0&&(l(o),o=0),i.readyState=4,u==="load")i.onload(w);else if(u==="error")i.onerror(w);else if(u==="abort")i.onabort(w);else throw new TypeError;i.onreadystatechange()}},y=function(u){r!=null&&(r.readyState===4?(!("onload"in r)||!("onerror"in r)||!("onabort"in r))&&p(r.responseText===""?"error":"load",u):r.readyState===3?"onprogress"in r||E():r.readyState===2&&v())},m=function(){o=a(function(){m()},500),r.readyState===3&&E()};"onload"in r&&(r.onload=function(u){p("load",u)}),"onerror"in r&&(r.onerror=function(u){p("error",u)}),"onabort"in r&&(r.onabort=function(u){p("abort",u)}),"onprogress"in r&&(r.onprogress=E),"onreadystatechange"in r&&(r.onreadystatechange=function(u){y(u)}),("contentType"in r||!("ontimeout"in s.prototype))&&(n+=(n.indexOf("?")===-1?"?":"&")+"padding=true"),r.open(e,n,!0),"readyState"in r&&(o=a(function(){m()},0))},b.prototype.abort=function(){this._abort(!1)},b.prototype.getResponseHeader=function(e){return this._contentType},b.prototype.setRequestHeader=function(e,n){var i=this._xhr;"setRequestHeader"in i&&i.setRequestHeader(e,n)},b.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},b.prototype.send=function(){if((!("ontimeout"in s.prototype)||!("sendAsBinary"in s.prototype)&&!("mozAnon"in s.prototype))&&N!=null&&N.readyState!=null&&N.readyState!=="complete"){var e=this;e._sendTimeout=a(function(){e._sendTimeout=0,e.send()},4);return}var n=this._xhr;"withCredentials"in n&&(n.withCredentials=this.withCredentials);try{n.send(void 0)}catch(i){throw i}};function le(e){return e.replace(/[A-Z]/g,function(n){return String.fromCharCode(n.charCodeAt(0)+32)})}function $(e){for(var n=Object.create(null),i=e.split(`\r
`),r=0;r<i.length;r+=1){var c=i[r],o=c.split(": "),v=o.shift(),E=o.join(": ");n[le(v)]=E}this._map=n}$.prototype.get=function(e){return this._map[le(e)]},s!=null&&s.HEADERS_RECEIVED==null&&(s.HEADERS_RECEIVED=2);function Ee(){}Ee.prototype.open=function(e,n,i,r,c,o,v){e.open("GET",c);var E=0;e.onprogress=function(){var y=e.responseText,m=y.slice(E);E+=m.length,i(m)},e.onerror=function(y){y.preventDefault(),r(new Error("NetworkError"))},e.onload=function(){r(null)},e.onabort=function(){r(null)},e.onreadystatechange=function(){if(e.readyState===s.HEADERS_RECEIVED){var y=e.status,m=e.statusText,u=e.getResponseHeader("Content-Type"),w=e.getAllResponseHeaders();n(y,m,u,new $(w))}},e.withCredentials=o;for(var p in v)Object.prototype.hasOwnProperty.call(v,p)&&e.setRequestHeader(p,v[p]);return e.send(),e};function ve(e){this._headers=e}ve.prototype.get=function(e){return this._headers.get(e)};function we(){}we.prototype.open=function(e,n,i,r,c,o,v){var E=null,p=new J,y=p.signal,m=new R;return K(c,{headers:v,credentials:o?"include":"same-origin",signal:y,cache:"no-store"}).then(function(u){return E=u.body.getReader(),n(u.status,u.statusText,u.headers.get("Content-Type"),new ve(u.headers)),new O(function(w,Y){var ge=function(){E.read().then(function(B){if(B.done)w(void 0);else{var k=m.decode(B.value,{stream:!0});i(k),ge()}}).catch(function(B){Y(B)})};ge()})}).catch(function(u){if(u.name!=="AbortError")return u}).then(function(u){r(u)}),{abort:function(){E!=null&&E.cancel(),p.abort()}}};function ne(){this._listeners=Object.create(null)}function be(e){a(function(){throw e},0)}ne.prototype.dispatchEvent=function(e){e.target=this;var n=this._listeners[e.type];if(n!=null)for(var i=n.length,r=0;r<i;r+=1){var c=n[r];try{typeof c.handleEvent=="function"?c.handleEvent(e):c.call(this,e)}catch(o){be(o)}}},ne.prototype.addEventListener=function(e,n){e=String(e);var i=this._listeners,r=i[e];r==null&&(r=[],i[e]=r);for(var c=!1,o=0;o<r.length;o+=1)r[o]===n&&(c=!0);c||r.push(n)},ne.prototype.removeEventListener=function(e,n){e=String(e);var i=this._listeners,r=i[e];if(r!=null){for(var c=[],o=0;o<r.length;o+=1)r[o]!==n&&c.push(r[o]);c.length===0?delete i[e]:i[e]=c}};function te(e){this.type=e,this.target=void 0}function he(e,n){te.call(this,e),this.data=n.data,this.lastEventId=n.lastEventId}he.prototype=Object.create(te.prototype);function f(e,n){te.call(this,e),this.status=n.status,this.statusText=n.statusText,this.headers=n.headers}f.prototype=Object.create(te.prototype);function d(e,n){te.call(this,e),this.error=n.error}d.prototype=Object.create(te.prototype);var g=-1,h=0,L=1,S=2,T=-1,C=0,z=1,oe=2,pe=3,Se=/^text\/event\-stream(;.*)?$/i,Je=1e3,ze=18e6,xe=function(e,n){var i=e==null?n:parseInt(e,10);return i!==i&&(i=n),Me(i)},Me=function(e){return Math.min(Math.max(e,Je),ze)},se=function(e,n,i){try{typeof n=="function"&&n.call(e,i)}catch(r){be(r)}};function W(e,n){ne.call(this),n=n||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,Qe(this,e,n)}function We(){return s!=null&&"withCredentials"in s.prototype||x==null?new s:new x}var Ye=K!=null&&ue!=null&&"body"in ue.prototype;function Qe(e,n,i){n=String(n);var r=Boolean(i.withCredentials),c=i.lastEventIdQueryParameterName||"lastEventId",o=Me(1e3),v=xe(i.heartbeatTimeout,45e3),E="",p=o,y=!1,m=0,u=i.headers||{},w=i.Transport,Y=Ye&&w==null?void 0:new b(w!=null?new w:We()),ge=w!=null&&typeof w!="string"?new w:Y==null?new we:new Ee,B=void 0,k=0,G=g,fe="",Te="",Q="",Ce="",P=C,Ve=0,ae=0,Ze=function(D,I,X,q){if(G===h)if(D===200&&X!=null&&Se.test(X)){G=L,y=Date.now(),p=o,e.readyState=L;var j=new f("open",{status:D,statusText:I,headers:q});e.dispatchEvent(j),se(e,e.onopen,j)}else{var F="";D!==200?(I&&(I=I.replace(/\s+/g," ")),F="EventSource's response has a status "+D+" "+I+" that is not 200. Aborting the connection."):F="EventSource's response has a Content-Type specifying an unsupported type: "+(X==null?"-":X.replace(/\s+/g," "))+". Aborting the connection.",He();var j=new f("error",{status:D,statusText:I,headers:q});e.dispatchEvent(j),se(e,e.onerror,j),console.error(F)}},et=function(D){if(G===L){for(var I=-1,X=0;X<D.length;X+=1){var q=D.charCodeAt(X);(q===`
`.charCodeAt(0)||q==="\r".charCodeAt(0))&&(I=X)}var j=(I!==-1?Ce:"")+D.slice(0,I+1);Ce=(I===-1?Ce:"")+D.slice(I+1),D!==""&&(y=Date.now(),m+=D.length);for(var F=0;F<j.length;F+=1){var q=j.charCodeAt(F);if(P===T&&q===`
`.charCodeAt(0))P=C;else if(P===T&&(P=C),q==="\r".charCodeAt(0)||q===`
`.charCodeAt(0)){if(P!==C){P===z&&(ae=F+1);var Z=j.slice(Ve,ae-1),ee=j.slice(ae+(ae<F&&j.charCodeAt(ae)===" ".charCodeAt(0)?1:0),F);Z==="data"?(fe+=`
`,fe+=ee):Z==="id"?Te=ee:Z==="event"?Q=ee:Z==="retry"?(o=xe(ee,o),p=o):Z==="heartbeatTimeout"&&(v=xe(ee,v),k!==0&&(l(k),k=a(function(){ye()},v)))}if(P===C){if(fe!==""){E=Te,Q===""&&(Q="message");var de=new he(Q,{data:fe.slice(1),lastEventId:Te});if(e.dispatchEvent(de),Q==="open"?se(e,e.onopen,de):Q==="message"?se(e,e.onmessage,de):Q==="error"&&se(e,e.onerror,de),G===S)return}fe="",Q=""}P=q==="\r".charCodeAt(0)?T:C}else P===C&&(Ve=F,P=z),P===z?q===":".charCodeAt(0)&&(ae=F+1,P=oe):P===oe&&(P=pe)}}},je=function(D){if(G===L||G===h)G=g,k!==0&&(l(k),k=0),k=a(function(){ye()},p),p=Me(Math.min(o*16,p*2)),e.readyState=h;else if(G===S&&D!=null){console.error(D);var I=new d("error",{error:D});e.dispatchEvent(I),se(e,e.onerror,I)}},He=function(){G=S,B!=null&&(B.abort(),B=void 0),k!==0&&(l(k),k=0),e.readyState=S},ye=function(){if(k=0,G!==g){if(!y&&B!=null)je(new Error("No activity within "+v+" milliseconds. "+(G===h?"No response received.":m+" chars received.")+" Reconnecting.")),B!=null&&(B.abort(),B=void 0);else{var D=Math.max((y||Date.now())+v-Date.now(),1);y=!1,k=a(function(){ye()},D)}return}y=!1,m=0,k=a(function(){ye()},v),G=h,fe="",Q="",Te=E,Ce="",Ve=0,ae=0,P=C;var I=n;if(n.slice(0,5)!=="data:"&&n.slice(0,5)!=="blob:"&&E!==""){var X=n.indexOf("?");I=X===-1?n:n.slice(0,X+1)+n.slice(X+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(ee,de){return de===c?"":ee}),I+=(n.indexOf("?")===-1?"?":"&")+c+"="+encodeURIComponent(E)}var q=e.withCredentials,j={};j.Accept="text/event-stream";var F=e.headers;if(F!=null)for(var Z in F)Object.prototype.hasOwnProperty.call(F,Z)&&(j[Z]=F[Z]);try{B=ge.open(Y,Ze,et,je,I,q,j)}catch(ee){throw He(),ee}};e.url=n,e.readyState=h,e.withCredentials=r,e.headers=u,e._close=He,ye()}W.prototype=Object.create(ne.prototype),W.prototype.CONNECTING=h,W.prototype.OPEN=L,W.prototype.CLOSED=S,W.prototype.close=function(){this._close()},W.CONNECTING=h,W.OPEN=L,W.CLOSED=S,W.prototype.withCredentials=void 0;var Pe=V;s!=null&&(V==null||!("withCredentials"in V.prototype))&&(Pe=W),function(e){if(typeof Oe=="object"&&typeof Oe.exports=="object"){var n=e(ke);n!==void 0&&(Oe.exports=n)}else typeof define=="function"&&define.amd?define(["exports"],e):e(t)}(function(e){e.EventSourcePolyfill=W,e.NativeEventSource=V,e.EventSource=Pe})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:ke:globalThis)});var vt={};ft(vt,{Event:()=>U,initialize:()=>Ke});function Le(t){this.message=t}Le.prototype=new Error,Le.prototype.name="InvalidCharacterError";var Ue=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(t){var a=String(t).replace(/=+$/,"");if(a.length%4==1)throw new Le("'atob' failed: The string to be decoded is not correctly encoded.");for(var l,s,x=0,A=0,V="";s=a.charAt(A++);~s&&(l=x%4?64*l+s:s,x++%4)?V+=String.fromCharCode(255&l>>(-2*x&6)):0)s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(s);return V};function ut(t){var a=t.replace(/-/g,"+").replace(/_/g,"/");switch(a.length%4){case 0:break;case 2:a+="==";break;case 3:a+="=";break;default:throw"Illegal base64url string!"}try{return function(l){return decodeURIComponent(Ue(l).replace(/(.)/g,function(s,x){var A=x.charCodeAt(0).toString(16).toUpperCase();return A.length<2&&(A="0"+A),"%"+A}))}(a)}catch(l){return Ue(a)}}function Ae(t){this.message=t}function lt(t,a){if(typeof t!="string")throw new Ae("Invalid token specified");var l=(a=a||{}).header===!0?0:1;try{return JSON.parse(ut(t.split(".")[l]))}catch(s){throw new Ae("Invalid token specified: "+s.message)}}Ae.prototype=new Error,Ae.prototype.name="InvalidTokenError";var $e=lt;function Be(t){return{all:t=t||new Map,on:function(a,l){var s=t.get(a);s&&s.push(l)||t.set(a,[l])},off:function(a,l){var s=t.get(a);s&&s.splice(s.indexOf(l)>>>0,1)},emit:function(a,l){(t.get(a)||[]).slice().map(function(s){s(l)}),(t.get("*")||[]).slice().map(function(s){s(a,l)})}}}var Ge=ct(Xe());var U;(function(t){t.READY="ready",t.CONNECTED="connected",t.DISCONNECTED="disconnected",t.RECONNECTED="reconnected",t.CHANGED="changed",t.ERROR="error"})(U||(U={}));var qe={debug:!1,baseUrl:"https://config.ff.harness.io/api/1.0",eventUrl:"https://events.ff.harness.io/api/1.0",streamEnabled:!0,allAttributesPrivate:!1,privateAttributeNames:[]},ce=(t,...a)=>console.error(`[FF-SDK] ${t}`,...a),De=30*1e3;var ht="1.4.2",pt=500,Ne=globalThis.fetch,gt=Ge.EventSourcePolyfill,me=!!globalThis.Proxy,_e=t=>{let{value:a}=t;try{switch(t.kind.toLowerCase()){case"int":case"number":a=Number(a);break;case"boolean":a=a.toString().toLowerCase()==="true";break;case"json":a=JSON.parse(a);break}}catch(l){ce(l)}return a},Ke=(t,a,l)=>{let s,x,A,V,N,O=!0,K=()=>{O=!1},ue=()=>{O=!0},R=[],_=Be(),J=ie(ie({},qe),l),M=(f,...d)=>{J.debug&&console.debug(`[FF-SDK] ${f}`,...d)},re=f=>{if(O){let d=Date.now();d-f.lastAccessed>pt&&(f.count++,f.lastAccessed=d)}};globalThis.onbeforeunload=()=>{R.length&&globalThis.localStorage&&(K(),globalThis.localStorage.HARNESS_FF_METRICS=JSON.stringify(R),ue())};let Fe=(f,d)=>Ie(void 0,null,function*(){return(yield(yield Ne(`${d.baseUrl}/client/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:f,target:a})})).json()).authToken}),H=()=>{if(R.length){M("Sending metrics...",{metrics:R,evaluations:b});let f={metricsData:R.map(d=>({timestamp:Date.now(),count:d.count,metricsType:"FFMETRICS",attributes:[{key:"featureIdentifier",value:d.featureIdentifier},{key:"featureName",value:d.featureIdentifier},{key:"variationIdentifier",value:d.variationIdentifier},{key:"target",value:a.identifier},{key:"SDK_NAME",value:"JavaScript"},{key:"SDK_TYPE",value:"client"},{key:"SDK_VERSION",value:ht}]}))};Ne(`${J.eventUrl}/metrics/${s}?cluster=${x}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V}`},body:JSON.stringify(f)}).then(()=>{R=[]}).catch(d=>{M(d)}).finally(()=>{N=window.setTimeout(H,De)})}else N=window.setTimeout(H,De)},b={},le=function(){return me?new Proxy({},{get(f,d){var h,L,S;let g=f[d];if(f.hasOwnProperty(d)){let T=f[d],C=R.find(z=>z.featureIdentifier===d&&T===z.featureValue);C?(C.variationIdentifier=((h=b[d])==null?void 0:h.identifier)||"",re(C)):R.push({featureIdentifier:d,featureValue:T,variationIdentifier:((L=b[d])==null?void 0:L.identifier)||"",count:O?1:0,lastAccessed:Date.now()}),M("Metrics event: Flag:",d,"has been read with value:",T,"variationIdentifier:",(S=b[d])==null?void 0:S.identifier)}return g}}):{}},$=le();Fe(t,J).then(f=>{V=f;let d=$e(f);if(M("Authenticated",d),globalThis.localStorage&&globalThis.localStorage.HARNESS_FF_METRICS)try{delete globalThis.localStorage.HARNESS_FF_METRICS,M("Picking up metrics from previous session")}catch(g){}N=window.setTimeout(H,De),s=d.environment,x=d.clusterIdentifier,Ee().then(()=>{M("Fetch all flags ok",$)}).then(()=>{we()}).then(()=>{M("Event stream ready",{storage:$}),_.emit(U.READY,$),me||Object.keys($).forEach(g=>{var h;R.push({featureIdentifier:g,featureValue:$[g],variationIdentifier:((h=b[g])==null?void 0:h.identifier)||"",count:O?1:0,lastAccessed:Date.now()})})}).catch(g=>{_.emit(U.ERROR,g)})}).catch(f=>{ce("Authentication error: ",f),_.emit(U.ERROR,f)});let Ee=()=>Ie(void 0,null,function*(){try{(yield(yield Ne(`${J.baseUrl}/client/env/${s}/target/${a.identifier}/evaluations?cluster=${x}`,{headers:{Authorization:`Bearer ${V}`}})).json()).forEach(g=>{let h=_e(g);$[g.flag]=h,b[g.flag]=ie(ie({},g),{value:h})})}catch(f){return ce("Features fetch operation error: ",f),_.emit(U.ERROR,f),f}}),ve=f=>Ie(void 0,null,function*(){var d;try{let g=yield Ne(`${J.baseUrl}/client/env/${s}/target/${a.identifier}/evaluations/${f}?cluster=${x}`,{headers:{Authorization:`Bearer ${V}`}});if(g.ok){let h=yield g.json(),L=_e(h);if(K(),$[f]=L,b[f]=ie(ie({},h),{value:L}),ue(),_.emit(U.CHANGED,me?new Proxy(h,{get(S,T){var C;if(S.hasOwnProperty(T)&&T==="value"){let z=S.flag,oe=h.value,pe=R.find(Se=>Se.featureIdentifier===z&&Se.featureValue===oe);pe?(re(pe),pe.variationIdentifier=((C=b[z])==null?void 0:C.identifier)||""):R.push({featureIdentifier:z,featureValue:String(oe),variationIdentifier:b[z].identifier||"",count:O?1:0,lastAccessed:Date.now()}),M("Metrics event: Flag",T,"has been read with value via stream update",oe)}return T==="value"?_e(h):h[T]}}):{deleted:h.deleted,flag:h.flag,value:_e(h)}),!me){let S=h.flag,T=R.find(C=>C.featureIdentifier===S&&C.featureValue===h.value);T?(re(T),T.variationIdentifier=((d=b[S])==null?void 0:d.identifier)||""):R.push({featureIdentifier:S,featureValue:String(h.value),variationIdentifier:b[S].identifier||"",count:O?1:0,lastAccessed:Date.now()})}}else _.emit(U.ERROR,g)}catch(g){ce("Feature fetch operation error: ",g),_.emit(U.ERROR,g)}}),we=()=>{if(!J.streamEnabled){M("Stream is disabled by configuration. Note: Polling is not yet supported");return}A=new gt(`${J.baseUrl}/stream`,{headers:{Authorization:`Bearer ${V}`,"API-Key":t}}),A.onopen=f=>{M("Stream connected",f),_.emit(U.CONNECTED)},A.onclose=f=>{M("Stream disconnected"),_.emit(U.DISCONNECTED)},A.onerror=f=>{ce("Stream has issue",f),_.emit("error",f)},A.addEventListener("*",f=>{let d=JSON.parse(f.data);switch(M("Received event from stream: ",d),d.event){case"create":setTimeout(()=>ve(d.identifier),1e3);break;case"patch":ve(d.identifier);break;case"delete":delete $[d.identifier],_.emit(U.CHANGED,{flag:d.identifier,value:void 0,deleted:!0}),M("Evaluation deleted",{message:d,storage:$});break}})},ne=(f,d)=>_.on(f,d),be=(f,d)=>{f?_.off(f,d):he()},te=(f,d)=>{var h;let g=$[f];if(!me&&g!==void 0){let L=g,S=f,T=R.find(C=>C.featureIdentifier===S&&C.featureValue===L);T?(re(T),T.variationIdentifier=((h=b[S])==null?void 0:h.identifier)||""):R.push({featureIdentifier:S,featureValue:L,count:O?1:0,variationIdentifier:b[S].identifier||"",lastAccessed:Date.now()})}return g!==void 0?g:d},he=()=>{M("Closing event stream"),$=le(),b={},clearTimeout(N),_.all.clear(),A.close()};return{on:ne,off:be,variation:te,close:he}};return vt;})();
/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
//# sourceMappingURL=sdk.client-iife.js.map
