var Qe=Object.create,Fe=Object.defineProperty,Ze=Object.getPrototypeOf,et=Object.prototype.hasOwnProperty,tt=Object.getOwnPropertyNames,rt=Object.getOwnPropertyDescriptor;var nt=n=>Fe(n,"__esModule",{value:!0});var at=(n,i)=>()=>(i||(i={exports:{}},n(i.exports,i)),i.exports);var it=(n,i,p)=>{if(i&&typeof i=="object"||typeof i=="function")for(let d of tt(i))!et.call(n,d)&&d!=="default"&&Fe(n,d,{get:()=>i[d],enumerable:!(p=rt(i,d))||p.enumerable});return n},ot=n=>it(nt(Fe(n!=null?Qe(Ze(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var je=at((Me,Te)=>{(function(n){"use strict";var i=n.setTimeout,p=n.clearTimeout,d=n.XMLHttpRequest,k=n.XDomainRequest,D=n.ActiveXObject,P=n.EventSource,j=n.document,K=n.Promise,ee=n.fetch,de=n.Response,C=n.TextDecoder,A=n.TextEncoder,J=n.AbortController;if(typeof window!="undefined"&&typeof j!="undefined"&&!("readyState"in j)&&j.body==null&&(j.readyState="loading",window.addEventListener("load",function(e){j.readyState="complete"},!1)),d==null&&D!=null&&(d=function(){return new D("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function r(){}return r.prototype=e,new r}),Date.now||(Date.now=function(){return new Date().getTime()}),J==null){var N=ee;ee=function(e,r){var a=r.signal;return N(e,{headers:r.headers,credentials:r.credentials,cache:r.cache}).then(function(t){var c=t.body.getReader();return a._reader=c,a._aborted&&a._reader.cancel(),{status:t.status,statusText:t.statusText,headers:t.headers,body:{getReader:function(){return c}}}})},J=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function te(){this.bitsNeeded=0,this.codePoint=0}te.prototype.decode=function(e){function r(g,y,u){if(u===1)return g>=128>>y&&g<<y<=2047;if(u===2)return g>=2048>>y&&g<<y<=55295||g>=57344>>y&&g<<y<=65535;if(u===3)return g>=65536>>y&&g<<y<=1114111;throw new Error}function a(g,y){if(g===6*1)return y>>6>15?3:y>31?2:1;if(g===6*2)return y>15?3:2;if(g===6*3)return 3;throw new Error}for(var t=65533,c="",s=this.bitsNeeded,l=this.codePoint,E=0;E<e.length;E+=1){var h=e[E];s!==0&&(h<128||h>191||!r(l<<6|h&63,s-6,a(s,l)))&&(s=0,l=t,c+=String.fromCharCode(l)),s===0?(h>=0&&h<=127?(s=0,l=h):h>=192&&h<=223?(s=6*1,l=h&31):h>=224&&h<=239?(s=6*2,l=h&15):h>=240&&h<=247?(s=6*3,l=h&7):(s=0,l=t),s!==0&&!r(l,s,a(s,l))&&(s=0,l=t)):(s-=6,l=l<<6|h&63),s===0&&(l<=65535?c+=String.fromCharCode(l):(c+=String.fromCharCode(55296+(l-65535-1>>10)),c+=String.fromCharCode(56320+(l-65535-1&1023))))}return this.bitsNeeded=s,this.codePoint=l,c};var Ae=function(){try{return new C().decode(new A().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(C==null||A==null||!Ae())&&(C=te);var _=function(){};function b(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=_,this.onload=_,this.onerror=_,this.onreadystatechange=_,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=_}b.prototype.open=function(e,r){this._abort(!0);var a=this,t=this._xhr,c=1,s=0;this._abort=function(u){a._sendTimeout!==0&&(p(a._sendTimeout),a._sendTimeout=0),(c===1||c===2||c===3)&&(c=4,t.onload=_,t.onerror=_,t.onabort=_,t.onprogress=_,t.onreadystatechange=_,t.abort(),s!==0&&(p(s),s=0),u||(a.readyState=4,a.onabort(null),a.onreadystatechange())),c=0};var l=function(){if(c===1){var u=0,w="",z=void 0;if("contentType"in t)u=200,w="OK",z=t.contentType;else try{u=t.status,w=t.statusText,z=t.getResponseHeader("Content-Type")}catch(he){u=0,w="",z=void 0}u!==0&&(c=2,a.readyState=2,a.status=u,a.statusText=w,a._contentType=z,a.onreadystatechange())}},E=function(){if(l(),c===2||c===3){c=3;var u="";try{u=t.responseText}catch(w){}a.readyState=3,a.responseText=u,a.onprogress()}},h=function(u,w){if((w==null||w.preventDefault==null)&&(w={preventDefault:_}),E(),c===1||c===2||c===3){if(c=4,s!==0&&(p(s),s=0),a.readyState=4,u==="load")a.onload(w);else if(u==="error")a.onerror(w);else if(u==="abort")a.onabort(w);else throw new TypeError;a.onreadystatechange()}},g=function(u){t!=null&&(t.readyState===4?(!("onload"in t)||!("onerror"in t)||!("onabort"in t))&&h(t.responseText===""?"error":"load",u):t.readyState===3?"onprogress"in t||E():t.readyState===2&&l())},y=function(){s=i(function(){y()},500),t.readyState===3&&E()};"onload"in t&&(t.onload=function(u){h("load",u)}),"onerror"in t&&(t.onerror=function(u){h("error",u)}),"onabort"in t&&(t.onabort=function(u){h("abort",u)}),"onprogress"in t&&(t.onprogress=E),"onreadystatechange"in t&&(t.onreadystatechange=function(u){g(u)}),("contentType"in t||!("ontimeout"in d.prototype))&&(r+=(r.indexOf("?")===-1?"?":"&")+"padding=true"),t.open(e,r,!0),"readyState"in t&&(s=i(function(){y()},0))},b.prototype.abort=function(){this._abort(!1)},b.prototype.getResponseHeader=function(e){return this._contentType},b.prototype.setRequestHeader=function(e,r){var a=this._xhr;"setRequestHeader"in a&&a.setRequestHeader(e,r)},b.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},b.prototype.send=function(){if((!("ontimeout"in d.prototype)||!("sendAsBinary"in d.prototype)&&!("mozAnon"in d.prototype))&&j!=null&&j.readyState!=null&&j.readyState!=="complete"){var e=this;e._sendTimeout=i(function(){e._sendTimeout=0,e.send()},4);return}var r=this._xhr;"withCredentials"in r&&(r.withCredentials=this.withCredentials);try{r.send(void 0)}catch(a){throw a}};function ce(e){return e.replace(/[A-Z]/g,function(r){return String.fromCharCode(r.charCodeAt(0)+32)})}function V(e){for(var r=Object.create(null),a=e.split(`\r
`),t=0;t<a.length;t+=1){var c=a[t],s=c.split(": "),l=s.shift(),E=s.join(": ");r[ce(l)]=E}this._map=r}V.prototype.get=function(e){return this._map[ce(e)]},d!=null&&d.HEADERS_RECEIVED==null&&(d.HEADERS_RECEIVED=2);function ye(){}ye.prototype.open=function(e,r,a,t,c,s,l){e.open("GET",c);var E=0;e.onprogress=function(){var g=e.responseText,y=g.slice(E);E+=y.length,a(y)},e.onerror=function(g){g.preventDefault(),t(new Error("NetworkError"))},e.onload=function(){t(null)},e.onabort=function(){t(null)},e.onreadystatechange=function(){if(e.readyState===d.HEADERS_RECEIVED){var g=e.status,y=e.statusText,u=e.getResponseHeader("Content-Type"),w=e.getAllResponseHeaders();r(g,y,u,new V(w))}},e.withCredentials=s;for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&e.setRequestHeader(h,l[h]);return e.send(),e};function ue(e){this._headers=e}ue.prototype.get=function(e){return this._headers.get(e)};function me(){}me.prototype.open=function(e,r,a,t,c,s,l){var E=null,h=new J,g=h.signal,y=new C;return ee(c,{headers:l,credentials:s?"include":"same-origin",signal:g,cache:"no-store"}).then(function(u){return E=u.body.getReader(),r(u.status,u.statusText,u.headers.get("Content-Type"),new ue(u.headers)),new K(function(w,z){var he=function(){E.read().then(function(U){if(U.done)w(void 0);else{var F=y.decode(U.value,{stream:!0});a(F),he()}}).catch(function(U){z(U)})};he()})}).catch(function(u){if(u.name!=="AbortError")return u}).then(function(u){t(u)}),{abort:function(){E!=null&&E.cancel(),h.abort()}}};function re(){this._listeners=Object.create(null)}function Ee(e){i(function(){throw e},0)}re.prototype.dispatchEvent=function(e){e.target=this;var r=this._listeners[e.type];if(r!=null)for(var a=r.length,t=0;t<a;t+=1){var c=r[t];try{typeof c.handleEvent=="function"?c.handleEvent(e):c.call(this,e)}catch(s){Ee(s)}}},re.prototype.addEventListener=function(e,r){e=String(e);var a=this._listeners,t=a[e];t==null&&(t=[],a[e]=t);for(var c=!1,s=0;s<t.length;s+=1)t[s]===r&&(c=!0);c||t.push(r)},re.prototype.removeEventListener=function(e,r){e=String(e);var a=this._listeners,t=a[e];if(t!=null){for(var c=[],s=0;s<t.length;s+=1)t[s]!==r&&c.push(t[s]);c.length===0?delete a[e]:a[e]=c}};function Z(e){this.type=e,this.target=void 0}function le(e,r){Z.call(this,e),this.data=r.data,this.lastEventId=r.lastEventId}le.prototype=Object.create(Z.prototype);function f(e,r){Z.call(this,e),this.status=r.status,this.statusText=r.statusText,this.headers=r.headers}f.prototype=Object.create(Z.prototype);function o(e,r){Z.call(this,e),this.error=r.error}o.prototype=Object.create(Z.prototype);var v=-1,S=0,m=1,T=2,H=-1,X=0,ne=1,ve=2,Be=3,Xe=/^text\/event\-stream(;.*)?$/i,qe=1e3,Ge=18e6,Oe=function(e,r){var a=e==null?r:parseInt(e,10);return a!==a&&(a=r),De(a)},De=function(e){return Math.min(Math.max(e,qe),Ge)},oe=function(e,r,a){try{typeof r=="function"&&r.call(e,a)}catch(t){Ee(t)}};function q(e,r){re.call(this),r=r||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,ze(this,e,r)}function Ke(){return d!=null&&"withCredentials"in d.prototype||k==null?new d:new k}var Je=ee!=null&&de!=null&&"body"in de.prototype;function ze(e,r,a){r=String(r);var t=Boolean(a.withCredentials),c=a.lastEventIdQueryParameterName||"lastEventId",s=De(1e3),l=Oe(a.heartbeatTimeout,45e3),E="",h=s,g=!1,y=0,u=a.headers||{},w=a.Transport,z=Je&&w==null?void 0:new b(w!=null?new w:Ke()),he=w!=null&&typeof w!="string"?new w:z==null?new me:new ye,U=void 0,F=0,G=v,se="",we="",W="",be="",x=X,Ne=0,ae=0,We=function(I,R,$,B){if(G===S)if(I===200&&$!=null&&Xe.test($)){G=m,g=Date.now(),h=s,e.readyState=m;var M=new f("open",{status:I,statusText:R,headers:B});e.dispatchEvent(M),oe(e,e.onopen,M)}else{var O="";I!==200?(R&&(R=R.replace(/\s+/g," ")),O="EventSource's response has a status "+I+" "+R+" that is not 200. Aborting the connection."):O="EventSource's response has a Content-Type specifying an unsupported type: "+($==null?"-":$.replace(/\s+/g," "))+". Aborting the connection.",_e();var M=new f("error",{status:I,statusText:R,headers:B});e.dispatchEvent(M),oe(e,e.onerror,M),console.error(O)}},Ye=function(I){if(G===m){for(var R=-1,$=0;$<I.length;$+=1){var B=I.charCodeAt($);(B===`
`.charCodeAt(0)||B==="\r".charCodeAt(0))&&(R=$)}var M=(R!==-1?be:"")+I.slice(0,R+1);be=(R===-1?be:"")+I.slice(R+1),I!==""&&(g=Date.now(),y+=I.length);for(var O=0;O<M.length;O+=1){var B=M.charCodeAt(O);if(x===H&&B===`
`.charCodeAt(0))x=X;else if(x===H&&(x=X),B==="\r".charCodeAt(0)||B===`
`.charCodeAt(0)){if(x!==X){x===ne&&(ae=O+1);var Y=M.slice(Ne,ae-1),Q=M.slice(ae+(ae<O&&M.charCodeAt(ae)===" ".charCodeAt(0)?1:0),O);Y==="data"?(se+=`
`,se+=Q):Y==="id"?we=Q:Y==="event"?W=Q:Y==="retry"?(s=Oe(Q,s),h=s):Y==="heartbeatTimeout"&&(l=Oe(Q,l),F!==0&&(p(F),F=i(function(){pe()},l)))}if(x===X){if(se!==""){E=we,W===""&&(W="message");var fe=new le(W,{data:se.slice(1),lastEventId:we});if(e.dispatchEvent(fe),W==="open"?oe(e,e.onopen,fe):W==="message"?oe(e,e.onmessage,fe):W==="error"&&oe(e,e.onerror,fe),G===T)return}se="",W=""}x=B==="\r".charCodeAt(0)?H:X}else x===X&&(Ne=O,x=ne),x===ne?B===":".charCodeAt(0)&&(ae=O+1,x=ve):x===ve&&(x=Be)}}},He=function(I){if(G===m||G===S){G=v,F!==0&&(p(F),F=0),F=i(function(){pe()},h),h=De(Math.min(s*16,h*2)),e.readyState=S;var R=new o("error",{error:I});e.dispatchEvent(R),oe(e,e.onerror,R),I!=null&&console.error(I)}},_e=function(){G=T,U!=null&&(U.abort(),U=void 0),F!==0&&(p(F),F=0),e.readyState=T},pe=function(){if(F=0,G!==v){if(!g&&U!=null)He(new Error("No activity within "+l+" milliseconds. "+(G===S?"No response received.":y+" chars received.")+" Reconnecting.")),U!=null&&(U.abort(),U=void 0);else{var I=Math.max((g||Date.now())+l-Date.now(),1);g=!1,F=i(function(){pe()},I)}return}g=!1,y=0,F=i(function(){pe()},l),G=S,se="",W="",we=E,be="",Ne=0,ae=0,x=X;var R=r;if(r.slice(0,5)!=="data:"&&r.slice(0,5)!=="blob:"&&E!==""){var $=r.indexOf("?");R=$===-1?r:r.slice(0,$+1)+r.slice($+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(Q,fe){return fe===c?"":Q}),R+=(r.indexOf("?")===-1?"?":"&")+c+"="+encodeURIComponent(E)}var B=e.withCredentials,M={};M.Accept="text/event-stream";var O=e.headers;if(O!=null)for(var Y in O)Object.prototype.hasOwnProperty.call(O,Y)&&(M[Y]=O[Y]);try{U=he.open(z,We,Ye,He,R,B,M)}catch(Q){throw _e(),Q}};e.url=r,e.readyState=S,e.withCredentials=t,e.headers=u,e._close=_e,pe()}q.prototype=Object.create(re.prototype),q.prototype.CONNECTING=S,q.prototype.OPEN=m,q.prototype.CLOSED=T,q.prototype.close=function(){this._close()},q.CONNECTING=S,q.OPEN=m,q.CLOSED=T,q.prototype.withCredentials=void 0;var Ve=P;d!=null&&(P==null||!("withCredentials"in P.prototype))&&(Ve=q),function(e){if(typeof Te=="object"&&typeof Te.exports=="object"){var r=e(Me);r!==void 0&&(Te.exports=r)}else typeof define=="function"&&define.amd?define(["exports"],e):e(n)}(function(e){e.EventSourcePolyfill=q,e.NativeEventSource=P,e.EventSource=Ve})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:Me:globalThis)});function xe(n){this.message=n}xe.prototype=new Error,xe.prototype.name="InvalidCharacterError";var Le=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var i=String(n).replace(/=+$/,"");if(i.length%4==1)throw new xe("'atob' failed: The string to be decoded is not correctly encoded.");for(var p,d,k=0,D=0,P="";d=i.charAt(D++);~d&&(p=k%4?64*p+d:d,k++%4)?P+=String.fromCharCode(255&p>>(-2*k&6)):0)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d);return P};function st(n){var i=n.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw"Illegal base64url string!"}try{return function(p){return decodeURIComponent(Le(p).replace(/(.)/g,function(d,k){var D=k.charCodeAt(0).toString(16).toUpperCase();return D.length<2&&(D="0"+D),"%"+D}))}(i)}catch(p){return Le(i)}}function Se(n){this.message=n}function ft(n,i){if(typeof n!="string")throw new Se("Invalid token specified");var p=(i=i||{}).header===!0?0:1;try{return JSON.parse(st(n.split(".")[p]))}catch(d){throw new Se("Invalid token specified: "+d.message)}}Se.prototype=new Error,Se.prototype.name="InvalidTokenError";var ke=ft;function Pe(n){return{all:n=n||new Map,on:function(i,p){var d=n.get(i);d&&d.push(p)||n.set(i,[p])},off:function(i,p){var d=n.get(i);d&&d.splice(d.indexOf(p)>>>0,1)},emit:function(i,p){(n.get(i)||[]).slice().map(function(d){d(p)}),(n.get("*")||[]).slice().map(function(d){d(i,p)})}}}var $e=ot(je());var L;(function(n){n.READY="ready",n.CONNECTED="connected",n.DISCONNECTED="disconnected",n.RECONNECTED="reconnected",n.CHANGED="changed",n.ERROR="error"})(L||(L={}));var Ue={debug:!1,baseUrl:"https://config.feature-flags.uat.harness.io/api/1.0",eventUrl:"https://event.feature-flags.uat.harness.io/api/1.0",streamEnabled:!0,allAttributesPrivate:!1,privateAttributeNames:[]},ie=(n,...i)=>console.error(`[FF-SDK] ${n}`,...i),Ce=30*1e3;var dt="1.3.0",ct=500,Re=globalThis.fetch,ut=$e.EventSourcePolyfill,ge=!!globalThis.Proxy,Ie=n=>{let{value:i}=n;try{switch(n.kind.toLowerCase()){case"int":case"number":i=Number(i);break;case"boolean":i=i.toString().toLowerCase()==="true";break;case"json":i=JSON.parse(i);break}}catch(p){ie(p)}return i},lt=(n,i,p)=>{let d,k,D,P,j,K=!0,ee=()=>{K=!1},de=()=>{K=!0},C=[],A=Pe(),J={...Ue,...p},N=(f,...o)=>{J.debug&&console.debug(`[FF-SDK] ${f}`,...o)},te=f=>{if(K){let o=Date.now();o-f.lastAccessed>ct&&(f.count++,f.lastAccessed=o)}};globalThis.onbeforeunload=()=>{C.length&&globalThis.localStorage&&(ee(),globalThis.localStorage.HARNESS_FF_METRICS=JSON.stringify(C),de())};let Ae=async(f,o)=>(await(await Re(`${o.baseUrl}/client/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:f,target:i})})).json()).authToken,_=()=>{if(C.length){N("Sending metrics...",{metrics:C,evaluations:b});let f={metricsData:C.map(o=>({timestamp:Date.now(),count:o.count,metricsType:"FFMETRICS",attributes:[{key:"featureIdentifier",value:o.featureIdentifier},{key:"featureName",value:o.featureIdentifier},{key:"variationIdentifier",value:o.variationIdentifier},{key:"target",value:i.identifier},{key:"SDK_NAME",value:"JavaScript"},{key:"SDK_TYPE",value:"client"},{key:"SDK_VERSION",value:dt}]}))};Re(`${p.eventUrl}/metrics/${d}?cluster=${k}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P}`},body:JSON.stringify(f)}).then(()=>{C=[]}).catch(o=>{ie(o)}).finally(()=>{j=window.setTimeout(_,Ce)})}else j=window.setTimeout(_,Ce)},b={},ce=function(){return ge?new Proxy({},{get(f,o){let v=f[o];if(f.hasOwnProperty(o)){let S=f[o],m=C.find(T=>T.featureIdentifier===o&&S===T.featureValue);m?(m.variationIdentifier=b[o]?.identifier||"",te(m)):C.push({featureIdentifier:o,featureValue:S,variationIdentifier:b[o]?.identifier||"",count:K?1:0,lastAccessed:Date.now()}),N("Metrics event: Flag:",o,"has been read with value:",S,"variationIdentifier:",b[o]?.identifier)}return v}}):{}},V=ce();Ae(n,J).then(f=>{P=f;let o=ke(f);if(N("Authenticated",o),globalThis.localStorage&&globalThis.localStorage.HARNESS_FF_METRICS)try{delete globalThis.localStorage.HARNESS_FF_METRICS,N("Picking up metrics from previous session")}catch(v){}j=window.setTimeout(_,Ce),d=o.environment,k=o.clusterIdentifier,ye().then(()=>{N("Fetch all flags ok",V)}).then(()=>{me()}).then(()=>{N("Event stream ready",{storage:V}),A.emit(L.READY,V),ge||Object.keys(V).forEach(v=>{C.push({featureIdentifier:v,featureValue:V[v],variationIdentifier:b[v]?.identifier||"",count:K?1:0,lastAccessed:Date.now()})})}).catch(v=>{A.emit(L.ERROR,v)})}).catch(f=>{ie("Authentication error: ",f),A.emit(L.ERROR,f)});let ye=async()=>{try{(await(await Re(`${J.baseUrl}/client/env/${d}/target/${i.identifier}/evaluations?cluster=${k}`,{headers:{Authorization:`Bearer ${P}`}})).json()).forEach(v=>{let S=Ie(v);V[v.flag]=S,b[v.flag]={...v,value:S}})}catch(f){return ie("Features fetch operation error: ",f),A.emit(L.ERROR,f),f}},ue=async f=>{try{let o=await Re(`${J.baseUrl}/client/env/${d}/target/${i.identifier}/evaluations/${f}?cluster=${k}`,{headers:{Authorization:`Bearer ${P}`}});if(o.ok){let v=await o.json(),S=Ie(v);if(ee(),V[f]=S,b[f]={...v,value:S},de(),A.emit(L.CHANGED,ge?new Proxy(v,{get(m,T){if(m.hasOwnProperty(T)&&T==="value"){let H=m.flag,X=v.value,ne=C.find(ve=>ve.featureIdentifier===H&&ve.featureValue===X);ne?(te(ne),ne.variationIdentifier=b[H]?.identifier||""):C.push({featureIdentifier:H,featureValue:String(X),variationIdentifier:b[H].identifier||"",count:K?1:0,lastAccessed:Date.now()}),N("Metrics event: Flag",T,"has been read with value via stream update",X)}return T==="value"?Ie(v):v[T]}}):{deleted:v.deleted,flag:v.flag,value:Ie(v)}),!ge){let m=v.flag,T=C.find(H=>H.featureIdentifier===m&&H.featureValue===v.value);T?(te(T),T.variationIdentifier=b[m]?.identifier||""):C.push({featureIdentifier:m,featureValue:String(v.value),variationIdentifier:b[m].identifier||"",count:K?1:0,lastAccessed:Date.now()})}}else A.emit(L.ERROR,o)}catch(o){ie("Feature fetch operation error: ",o),A.emit(L.ERROR,o)}},me=()=>{if(!J.streamEnabled){N("Stream is disabled by configuration. Note: Polling is not yet supported");return}D=new ut(`${J.baseUrl}/stream`,{headers:{Authorization:`Bearer ${P}`,"API-Key":n}}),D.onopen=f=>{N("Stream connected",f),A.emit(L.CONNECTED)},D.onclose=f=>{N("Stream disconnected"),A.emit(L.DISCONNECTED)},D.onerror=f=>{ie("Stream has issue",f),A.emit("error",f)},D.addEventListener("*",f=>{let o=JSON.parse(f.data);switch(N("Received event from stream: ",o),o.event){case"create":setTimeout(()=>ue(o.identifier),1e3);break;case"patch":ue(o.identifier);break;case"delete":delete V[o.identifier],A.emit(L.CHANGED,{flag:o.identifier,value:void 0,deleted:!0}),N("Evaluation deleted",{message:o,storage:V});break}})},re=(f,o)=>A.on(f,o),Ee=(f,o)=>{f?A.off(f,o):le()},Z=(f,o)=>{let v=V[f];if(!ge&&v!==void 0){let S=v,m=f,T=C.find(H=>H.featureIdentifier===m&&H.featureValue===S);T?(te(T),T.variationIdentifier=b[m]?.identifier||""):C.push({featureIdentifier:m,featureValue:S,count:K?1:0,variationIdentifier:b[m].identifier||"",lastAccessed:Date.now()})}return v!==void 0?v:o},le=()=>{N("Closing event stream"),V=ce(),b={},clearTimeout(j),A.all.clear(),D.close()};return{on:re,off:Ee,variation:Z,close:le}};export{L as Event,lt as initialize};
/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
//# sourceMappingURL=sdk.client.js.map
